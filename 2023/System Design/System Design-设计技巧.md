[TOC]

# System Design Interview(2)

## 系统设计中的数据估算

### 延迟相关

| 操作名称                          | 时间                 |
| --------------------------------- | -------------------- |
| L1缓存标准                        | 0.5 ns               |
| 分支错误预测（Branch mispredict） | 5 ns                 |
| L2缓存标准                        | 7 ns                 |
| 互斥锁 Mutex 锁/解锁              | 100 ns               |
| 主内存标准                        | 100 ns               |
| 用 Zippy 压缩 1KB 数据            | 10000 ns = 10 μs     |
| 在 1Gbps 网络中发送 2KB 数据      | 20000 ns = 20 μs     |
| 从内存中顺序读取 1MB 数据         | 250000 ns = 250 μs   |
| 在同一数据中心内跑一圈            | 500000 ns = 500 μs   |
| 硬盘搜索                          | 1000000 ns = 10 ms   |
| 从网络顺序读取 1MB 数据           | 1000000 ns = 10 ms   |
| 从硬盘顺序读取 1MB 数据           | 3000000 ns = 30 ms   |
| 发送数据报（加州-荷兰-加州）      | 15000000 ns = 150 ms |

从表中得出结论：

- 内存快，硬盘慢。
- 尽量避免使用硬盘搜索。
- 简单的压缩算法很快。
- 尽可能先压缩数据，再通过网络发送。
- 数据中心通常位于不同地区，彼此互传数据需要花费一段时间。

### 高可用相关

| 可用性 % | 每天停机时间 | 每周      | 每月      | 每年      |
| -------- | ------------ | --------- | --------- | --------- |
| 99%      | 14.40 min    | 1.68 h    | 7.31 h    | 3.65 d    |
| 99.9%    | 1.44 min     | 10.08 min | 43.83 min | 8.77 h    |
| 99.99%   | 8.64 s       | 1.01 min  | 4.38 min  | 52.60 min |
| 99.999%  | 864.00 ms    | 6.05 s    | 26.30 s   | 5.26 min  |
| 99.9999% | 86.40 ms     | 604.80 ms | 2.63 s    | 31.56 s   |

### 估算 Twitter 的 QPS 和所需的储存空间

假设：

- 每个月有3亿活跃用户。
- 每天有50%的用户会使用 Twitter。
- 用户平均每天发布两则推文。
- 10%的推文中包含了媒体。
- 数据会被存储5年。

估算：

每秒查询次数（QPS：Query Per Second）估算值：

- 每日活跃用户（DAU：Daily Active Users）= 3亿 * 50% = 1.5亿
- 推文 QPS = 1.5亿 * 2则推文 / 24h / 3600s = ~3500
- QPS 峰值 = 2 * QPS = ~7000

储存空间估算值：

- 平均推文大小：
  - tweet_id：64 Byte
  - 文字：140 Byte
  - 媒体：1MB
- 媒体所需储存空间：1.5亿 * 2 * 10% * 1MB = 每天 30 TB
- 5年所需的媒体储存空间：30 TB * 365 * 5 = ~55PB

## 系统设计面试技巧

>  以下按常规的系统设计面试给出通用的四步流程

### 步骤一——了解问题并确定设计的范围

- 我们要构建出哪些特定的功能？
- 这个产品会有多少使用者？
- 公司规模有多大，预期会以多大速度扩展？
- 公司有哪些技术强项可供运用？可以善用哪些已有的服务来简化设计？

### 步骤二——提出高阶设计并取得认可

- 提出设计的初始蓝图。可以要求面试官尽量提供任何回馈的意见。
- 用一些图表把关键构成元素画在白纸或白板上。
- 用粗略估计的方式，评估一下设计蓝图是否符合规模上的限制。

### 步骤三——深入设计

- 与面试官共同确定架构里的各种构成元素，并确认其优先顺序。
- 对系统中构成元素的细节进行讨论，可能是性能瓶颈和资源评估，或者是其中的算法等等。

### 步骤四——系统设计总结

- 面试官可能会希望你判断系统的瓶颈，并讨论可能的改造方案。
- 让面试官重新审视你的设计，或许是很有用的做法。如果你提出了好几个解决方案，这点尤其重要。
- 讨论一下出错的方案，如服务器故障、网络断线等，也是很有趣的一件事。
- 关于操作方面的问题，也很值得一提。比如如何监视各种衡量指标和错误日志？如何以滚动方式导入系统呢？
- 规模曲线（scale curve）的下一步该如何处理？举例来说，如果你现在的系统设计可支撑100w个用户，接下来需要进行哪些变动，才能支撑1000w个用户呢？

### 应该做的事

- 为了厘清情况，一定要把疑问问出来，不要以为你的假设一定是正确的。
- 了解问题真正的需求。
- 既没有正确答案，也没有最佳的答案。请务必确认你了解真正的需求。
- 如果可能的话，尽量提出多种做法。
- 你一旦针对设计蓝图与面试官达成了协议，接着就要深入每个构成元素的细节中。请先设计最关键的构成元素。
- 把构思告诉面试官，并询问他的意见。

### 不要做的事

- 面对典型的面试问题，不要什么准备都不做。

- 在没弄清楚需求与假设的情况下，不要急着跳入解决方案。

- 一开始不要针对单一的构成元素，深入到过多的细节中。请先进行高阶设计，然后再深入研究细节。

- 如果遇到困难，不要犹豫，随时可以询问有没有什么提示。

- 沟通很重要，不要只顾着自己一个人思考。

  