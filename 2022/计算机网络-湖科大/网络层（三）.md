[TOC]

# 网络层（三）

## 路由选择协议

|              |                 | 具体协议                    | 说明                                                         |
| :----------: | --------------- | --------------------------- | ------------------------------------------------------------ |
| 路由选择协议 | 内部网关协议IGP | 路由信息协议RIP             | **基于距离向量**：RIP在因特网上最早使用                      |
|              |                 | 内部网关路由协议IGRP        | **基于距离向量**：IGRP是思科早期私有的协议，现在已被EIGRP取代 |
|              |                 | 增强型内部网关路由协议EIGRP | **结合距离向量和链路状态**：思科私有的协议，用来取代IGRP的混合型路由协议 |
|              |                 | 开放式最短路径优先OSPF      | **基于链路状态**：OSPF在各种网络中广泛使用                   |
|              |                 | 中间系统到中间系统IS-IS     | **基于链路状态**：集成化IS-IS是ISP骨干网上最长常用的IGP协议  |
|              | 外部网关协议EGP | 边界网关协议BGP             |                                                              |



## 路由信息协议RIP的基本工作原理

- 路由信息协议RIP（Routing Infomation Protocol）是内部网关协议IGP中最先得到广泛使用的协议之一。
- RIP要求自治系统AS内的每一个路由器都要维护从它自己到AS内其他每一个网络的距离记录。这是一组距离，称为“距离向量”。
- RIP使用**跳数（Hop Count）作为度量（Metric）来衡量到达目的网络的距离**。
  - 路由器到直连网络的距离定义为1。
  - 路由器到非直连网络的距离定义为所经过的路由器数+1。
  - 允许一条路径最多只能包含15个路由器。“距离”等于16时相当于不可达。因此，**RIP只适用于小型互联网**。
- RIP认为好的路由就是“距离短”的路由，也就是所通过路由器数量最少的路由。
- 当到达同一目的网络有多条“距离相等”的路由时，可以进行等价负载均衡。
- RIP包含以下三个要点：
  - 和谁交换信息：仅和相邻路由器交换信息
  - 交换什么信息：自己的路由表
  - 何时交换信息：周期性交换（例如每30秒）
- **RIP的基本工作过程**
  1. 路由器刚开始工作时，只知道自己到直连网络的距离为1。
  2. 每个路由器仅和相邻路由器周期性地交换并更新路由信息。
  3. 若干次交换和更新后，每个路由器都知道到达本AS内各网络的最短距离和下一跳地址，称为收敛。
- **RIP的路由条目的更新规则**
  - 发现了新的网络，添加。
  - 到达目的网络，相同下一跳，最新消息，更新。
  - 到达目的网络，不同下一跳，新路由优势，更新。
  - 到达目的网络，不同下一跳，等价负载均衡。
  - 到达目的网络，不同下一跳，新路由劣势，不更新。
- RIP存在“坏消息传播得慢”的问题。
- “坏消息传播得慢”又称为路由环路或距离无穷计数的问题，这是距离向量算法的一个固有问题。可以采取多种措施减少出现该问题的概率或减小该问题带来的危害。
  - 限制最大路径距离为15（16表示不可达）。
  - 当路由表发生变化时就立即发送更新报文（即“触发更新”），而不仅是周期性发送。
  - 让路由器记录收到某特定路由信息的接口，而不让同一路由信息再通过此接口向反方向传送（即“水平分割”）。

